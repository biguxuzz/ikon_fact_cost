# Результаты замеров производительности алгоритма разузлования

## Результаты замеров

### СТАРЫЙ алгоритм (рекурсивный)

| Метрика | Замер 1 | Замер 2 | Замер 3 | Замер 4 | Среднее |
|---------|---------|---------|---------|---------|---------|
| Общее время (сек) | 23 | 28 | 32 | 58 | **28** |
| Время запросов (сек) | - | 26 | - | - | **26** |
| Время обработки (сек) | - | 0 | - | - | **0** |
| Время проверки циклов (сек) | - | 0 | - | - | **0** |

| Метрика | Значение |
|---------|----------|
| Количество запросов к БД | **47** |
| Количество проверок циклов | **13** |
| Макс. глубина | **7 уровней** |
| Доля времени на запросы | **92,9%** |

### НОВЫЙ алгоритм (пакетный)

| Метрика | Значение |
|---------|----------|
| Общее время (сек) | **31** |
| Время запросов (сек) | **30** (96,8%) |
| Время обработки (сек) | **1** (3,2%) |
| Время проверки циклов (сек) | **0** (0%) |
| Количество запросов к БД | **47** |
| Количество проверок циклов | **13** |
| Уровней дерева | **7** |

**Статистика по уровням:**

| Уровень | Количество узлов |
|---------|------------------|
| 1 | 1 |
| 2 | 1 |
| 3 | 5 |
| 4 | 4 |
| 5 | 8 |
| 6 | 12 |
| 7 | 16 |
| **Итого** | **47** |

---

## Сравнительная таблица

| Метрика | Старый | Новый | Разница |
|---------|--------|-------|---------|
| Общее время (сек) | 28 | 31 | **+11% (хуже)** |
| Время запросов (сек) | 26 | 30 | **+15% (хуже)** |
| Время обработки (сек) | 0 | 1 | **+1 сек** |
| Время проверки циклов (сек) | 0 | 0 | — |
| Количество запросов | 47 | 47 | **0% (без изменений!)** |
| Проверок циклов | 13 | 13 | — |

---

## Ключевые выводы

### 1. Пакетная обработка НЕ РЕАЛИЗОВАНА

| Факт | Ожидание | Реальность |
|------|----------|------------|
| Количество запросов | 7 (по числу уровней) | **47** (по числу узлов) |
| Время запросов | Значительное сокращение | **Без изменений** |

**Вывод**: Функция `РазузловатьУзлыПакетом` вызывает `СебестоимостьУзла()` для **каждого узла отдельно**, а не использует `СебестоимостьУзловПакетом()` для пакетной обработки.

### 2. Проверка циклов НЕ является узким местом

| Метрика | Значение |
|---------|----------|
| Время на проверку | **0 сек** |
| Количество проверок | **13** |
| Размер ПройденныйПуть | **~47 строк** |

**Вывод**: Оптимизация `ПройденныйПуть` через `Соответствие` **НЕ ТРЕБУЕТСЯ** — текущая реализация достаточно быстрая.

### 3. Запросы к БД — единственное узкое место

| Метрика | Значение |
|---------|----------|
| Доля времени на запросы | **93-97%** |
| Среднее время на 1 запрос | **~0,6 сек** |

**Вывод**: **100% усилий** должны быть направлены на сокращение количества запросов.

### 4. Новый алгоритм МЕДЛЕННЕЕ старого

| Причина | Влияние |
|---------|---------|
| Накладные расходы на структуры данных | **+1 сек** |
| Та же логика запросов | **+4 сек** |

**Вывод**: Без реализации пакетных запросов новый алгоритм **не имеет смысла**.

---

## Потенциал оптимизации

### При реализации пакетных запросов

| Текущее | После оптимизации | Экономия |
|---------|-------------------|----------|
| 47 запросов | 7 запросов (по уровням) | **85%** |
| ~28 сек | ~4-6 сек (оценка) | **80%** |

### Расчёт

- Текущее: 47 запросов × 0,6 сек = 28 сек
- После: 7 запросов × 0,6 сек = 4,2 сек
- **Ожидаемое ускорение: в 5-7 раз**

---

## Рекомендации

### Приоритет 1: Реализовать пакетные запросы

Функция `СебестоимостьУзловПакетом` уже существует в коде (строки 1133-1257), но **не используется**. Необходимо:
1. Интегрировать её в `РазузловатьУзлыПакетом`
2. Выполнять **один запрос** для всех узлов уровня

### Приоритет 2: НЕ делать (отменить)

| Оптимизация | Причина отмены |
|-------------|----------------|
| Соответствие для ПройденныйПуть | Время проверки = 0 сек, не узкое место |
| Кэширование партий | Нет повторяющихся партий (47 запросов = 47 узлов) |

---

## История замеров

| Дата | Алгоритм | Время (сек) | Запросов | Комментарий |
|------|----------|-------------|----------|-------------|
| - | Старый | 28 | 47 | Эталон |
| - | Новый (текущий) | 31 | 47 | Без пакетных запросов |
| - | Новый (после оптимизации) | ? | 7 | **Цель** |
