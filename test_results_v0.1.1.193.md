# Результаты тестирования версии 0.1.1.193

**Дата проверки:** 23.01.2026  
**Период проверки:** 01.01.2025 - 31.12.2025  
**Продукция:** А/шина 155 R 12C 83/81P BARS UZ600 OEM (УзАвто)

## ❌ КРИТИЧЕСКОЕ РАСХОЖДЕНИЕ ОБНАРУЖЕНО

### Итоговые показатели

| Показатель | Эталон (prod_cost) | Новый алгоритм (prod_cost_ext) | Расхождение |
|------------|-------------------|-------------------------------|-------------|
| **Итого Стоимость** | 2 758 680,11 | 2 743 465,76 | **-15 214,35** ❌ |
| **Материальные** | 2 635 997,55 | 2 635 997,65 | +0,10 ✓ |
| **Доп. расходы** | **64 087,86** | **48 873,36** | **-15 214,50** ❌ |
| **Постатейные постоянные** | 58 594,71 | 58 594,71 | 0,00 ✓ |
| **НУ** | 2 758 680,11 | 2 758 680,27 | +0,16 ✓ |

### Детальный анализ расхождений по позициям

#### Позиции с расхождениями в дополнительных расходах:

1. **Антиокислитель 6PPD (4020)**
   - Эталон: Доп. расходы = 600,95
   - Новый: Доп. расходы = 0 (не отображается)
   - ❌ **Недостает: 600,95**

2. **Антиокислитель TMQ(RD)**
   - Эталон: Доп. расходы = 236,32
   - Новый: Доп. расходы = 208,34
   - ❌ **Недостает: 27,98**

3. **Диоксид кремния с высокой дисперсией**
   - Эталон: Доп. расходы = 195,88
   - Новый: Доп. расходы = 172,69
   - ❌ **Недостает: 23,19**

4. **Каучук натуральный STR 20**
   - Эталон: Доп. расходы = 36 005,64
   - Новый: Доп. расходы = 31 742,26
   - ❌ **Недостает: 4 263,38**

5. **Кобальт ацилирования**
   - Эталон: Доп. расходы = 3 409,45
   - Новый: Доп. расходы = 403,71
   - ❌ **Недостает: 3 005,74**

6. **Нерастворимая сера HD OT20**
   - Эталон: Доп. расходы = 594,82
   - Новый: Доп. расходы = 119,28
   - ❌ **Недостает: 475,54**

7. **оксид цинка**
   - Эталон: Доп. расходы = 303,92
   - Новый: Доп. расходы = 35,99
   - ❌ **Недостает: 267,93**

8. **Смола склеивания RFS-20**
   - Эталон: Доп. расходы = 1 204,34
   - Новый: Доп. расходы = 142,60
   - ❌ **Недостает: 1 061,74**

9. **Стеариновая кислота**
   - Эталон: Доп. расходы = 8,44
   - Новый: Доп. расходы = 1,00
   - ❌ **Недостает: 7,44**

10. **Технический углерод №326 (JiangXi)**
    - Эталон: Доп. расходы = 17 089,99
    - Новый: Доп. расходы = 12 167,14
    - ❌ **Недостает: 4 922,85**

11. **Усиленная смола фенолальдегида SP6700**
    - Эталон: Доп. расходы = 649,30
    - Новый: Доп. расходы = 572,42
    - ❌ **Недостает: 76,88**

12. **Ускоритель TBBS**
    - Эталон: Доп. расходы = 378,12
    - Новый: Доп. расходы = 0 (не отображается)
    - ❌ **Недостает: 378,12**

13. **Экологичный пептизатор DBD**
    - Эталон: Доп. расходы = 102,76
    - Новый: Доп. расходы = 0 (не отображается)
    - ❌ **Недостает: 102,76**

### Сумма всех расхождений: 15 214,50

## Анализ проблемы

### Вероятная причина ошибки

В функции `ikon_cost_ТекстЗапроса_ТекстДопРасходыОбъединение()` используется:
- `ВНУТРЕННЕЕ СОЕДИНЕНИЕ` с таблицей `ВыпущеннаяПродукция`
- Пропорция `ВыпущеннаяПродукция.Числитель / ВыпущеннаяПродукция.Знаменатель`

**Проблема:** Внутреннее соединение может исключать записи из `ДетализацияСебестоимости`, для которых нет соответствующих записей в `ВыпущеннаяПродукция` по условиям соединения. Это приводит к неполному распределению дополнительных расходов.

### Влияние на результаты

- **Недораспределение дополнительных расходов:** ~24% (15 214,50 из 64 087,86)
- **Некоторые позиции полностью отсутствуют** в новом алгоритме (Антиокислитель 6PPD, Ускоритель TBBS, Экологичный пептизатор DBD)
- **Итоговая стоимость занижена** на сумму недораспределенных дополнительных расходов

## Вывод

❌ **ТЕСТИРОВАНИЕ НЕ ПРОЙДЕНО**

Новый алгоритм версии 0.1.1.193 **не возвращает результаты, аналогичные эталону**. Обнаружено критическое недораспределение дополнительных расходов на сумму **15 214,50** (24% от эталонного значения).

### Рекомендации для исправления

1. Проверить условия соединения с таблицей `ВыпущеннаяПродукция` в функции `ikon_cost_ТекстЗапроса_ТекстДопРасходыОбъединение()`
2. Убедиться, что все записи из `ДетализацияСебестоимости` корректно соединяются с `ВыпущеннаяПродукция`
3. Возможно, требуется использовать `ЛЕВОЕ СОЕДИНЕНИЕ` вместо `ВНУТРЕННЕЕ СОЕДИНЕНИЕ` для сохранения всех записей
4. Проверить корректность расчета пропорции `Числитель / Знаменатель` для всех случаев

### Статус

**Возврат на доработку ДевОпсу** для исправления ошибки распределения дополнительных расходов.
